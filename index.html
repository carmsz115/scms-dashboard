<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCMS Professional Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2d3436;
            --danger: #ff7675;
            --warning: #fdcb6e;
            --success: #55efc4;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--primary); padding: 40px; margin: 0; }
        
        .header { margin-bottom: 40px; }
        .header h1 { margin: 0; color: #1e3799; }
        .status-dot { height: 10px; width: 10px; background-color: var(--success); border-radius: 50%; display: inline-block; margin-right: 5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: auto; }

        .card { 
            background: var(--card-bg); 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); 
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        /* Added: Styling for the Graph Container */
        .chart-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            max-width: 1200px;
            margin: 30px auto;
            height: 400px;
        }

        .label { font-size: 0.8rem; font-weight: 700; color: #636e72; text-transform: uppercase; letter-spacing: 1px; }
        .value { font-size: 3rem; font-weight: bold; margin: 15px 0; color: #2d3436; }
        
        .card.alert-red { background: var(--danger); color: white; transform: translateY(-5px); }
        .card.alert-yellow { background: var(--warning); transform: translateY(-5px); }
        .card.alert-red .label, .card.alert-red .value { color: white; }

        #last-sync { font-size: 0.8rem; color: #b2bec3; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>SCMS Master Dashboard</h1>
        <p><span class="status-dot"></span> System Live & Monitoring</p>
    </div>

    <div class="grid">
        <div id="temp-card" class="card">
            <div class="label">Room Temp</div>
            <div class="value"><span id="temp">--</span>Â°C</div>
            <div id="temp-msg">Normal</div>
        </div>

        <div class="card">
            <div class="label">Air Humidity</div>
            <div class="value"><span id="humid">--</span>%</div>
        </div>

        <div id="light-card" class="card">
            <div class="label">Environment Light</div>
            <div class="value" id="light-val" style="font-size: 1.5rem;">WAITING...</div>
        </div>

        <div id="motion-card" class="card">
            <div class="label">Focus Status</div>
            <div class="value" id="motion-val" style="font-size: 1.5rem;">ANALYZING...</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="liveChart"></canvas>
    </div>

    <p id="last-sync">Waiting for cloud data...</p>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAmpXrg4DnoW2aH6BFLYERZpF-a_sOQsjw",
            databaseURL: "https://scms-db4c9-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("study");

        // --- ADDED: Initialize the Chart ---
        const ctx = document.getElementById('liveChart').getContext('2d');
        const liveChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Temperature (Â°C)',
                        borderColor: '#ff7675',
                        backgroundColor: 'rgba(255, 118, 117, 0.1)',
                        data: [],
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Humidity (%)',
                        borderColor: '#55efc4',
                        backgroundColor: 'rgba(85, 239, 196, 0.1)',
                        data: [],
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'top' } },
                scales: { y: { beginAtZero: false } }
            }
        });

        db.on("value", (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            // Update Values (Your Original Logic)
            document.getElementById("temp").innerText = data.temp.toFixed(1);
            document.getElementById("humid").innerText = data.humidity.toFixed(0);
            
            // 1. Temperature Alert
            const tCard = document.getElementById("temp-card");
            if(data.temp > 32) {
                tCard.classList.add("alert-red");
                document.getElementById("temp-msg").innerText = "HOT: ALARM ON";
            } else {
                tCard.classList.remove("alert-red");
                document.getElementById("temp-msg").innerText = "Optimal";
            }

            // 2. Light Alert
            const lCard = document.getElementById("light-card");
            const lVal = document.getElementById("light-val");
            if(data.light == 1) {
                lCard.classList.add("alert-red");
                lVal.innerText = "TOO DARK! ðŸŒ™";
            } else {
                lCard.classList.remove("alert-red");
                lVal.innerText = "BRIGHT â˜€ï¸";
            }

            // 3. Motion Alert
            const mCard = document.getElementById("motion-card");
            const mVal = document.getElementById("motion-val");
            if(data.fidgeting) {
                mCard.classList.add("alert-yellow");
                mVal.innerText = "FIDGETING!";
            } else {
                mCard.classList.remove("alert-yellow");
                mVal.innerText = "FOCUSED";
            }

            // --- ADDED: Update the Graph ---
            const now = new Date().toLocaleTimeString();
            
            // Keep graph to 15 data points for clarity
            if (liveChart.data.labels.length > 15) {
                liveChart.data.labels.shift();
                liveChart.data.datasets[0].data.shift();
                liveChart.data.datasets[1].data.shift();
            }

            liveChart.data.labels.push(now);
            liveChart.data.datasets[0].data.push(data.temp);
            liveChart.data.datasets[1].data.push(data.humidity);
            liveChart.update();

            document.getElementById("last-sync").innerText = "Last Update: " + new Date().toLocaleTimeString();
        });
    </script>
</body>
</html>

